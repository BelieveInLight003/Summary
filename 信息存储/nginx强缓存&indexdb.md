### indexdb 与 nginx 对比

| 对比维度       | **HTTP 强缓存**                         | **IndexedDB 缓存**                                |
| -------------- | --------------------------------------- | ------------------------------------------------- |
| **读取性能**   | **0ms**（直接从磁盘缓存读取）           | **10-15ms 延迟**（异步 API + 磁盘 I/O）           |
| **代码成本**   | **0 行代码**（Nginx 配置即可）          | **100+ 行代码**（需实现初始化、读写、错误处理）   |
| **流量消耗**   | **有效期内 0 请求**（完全不访问服务器） | **从 indexdb 读取**                               |
| **缓存一致性** | **自动**（文件名哈希即更新）            | **手动管理**（需代码删除旧版本）                  |
| **浏览器支持** | **100% 完美兼容**（HTTP/1.0 标准）      | **兼容性差异**（Safari 性能差，隐私模式可能禁用） |
| **维护难度**   | **极低**（配置一次永久生效）            | **极高**（需处理版本、降级、清理策略）            |

#### 实际场景读取时间对比

| 场景               | HTTP 强缓存                  | IndexedDB 缓存                              | 用户体验               |
| ------------------ | ---------------------------- | ------------------------------------------- | ---------------------- |
| **首次访问**       | 下载 100KB → 显示（200ms）   | 下载 100KB → 存入 DB → 显示（200ms + 50ms） | 两者接近               |
| **同会话刷新**     | **0ms**（from memory cache） | **10-15ms**（IndexedDB 读取）               | IndexedDB **略卡顿**   |
| **关闭浏览器再开** | **0ms**（from disk cache）   | **15-50ms**（IndexedDB 磁盘读取）           | IndexedDB **明显卡顿** |
| **CPU 繁忙时**     | **0ms**                      | **956ms**（极端延迟）                       | **页面卡死近 1 秒**    |

#### indexdb 读取时间慢

- 根据实测数据，IndexedDB 读取耗时：
  CPU 空闲时：10-15ms
  CPU 繁忙时：180-956ms（接近 1 秒！）

- 根本原因：

```
  浏览器原生实现
    1  HTTP 强缓存由浏览器 C++底层直接读取磁盘缓存：
    2  读取路径：渲染进程 → 缓存子进程 → 内存映射文件
    3  耗时：纳秒级（< 1ms）
  IndexedDB 的实现
    1  IndexedDB 是 JavaScript API，运行在主线程：
    2  读取路径：主线程 → 序列化请求 → 磁盘 I/O → 反序列化 → 主线程
    3  耗时：毫秒级（10-956ms）
   关键差异：HTTP 缓存不阻塞主线程，IndexedDB 会阻塞（即使异步，回调前也会占用 CPU）
```
